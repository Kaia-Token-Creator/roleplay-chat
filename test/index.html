<!doctype html>
<html lang="en">
<head>

  <meta name='impact-site-verification' value='f343b3c2-5405-4f62-a4ed-b9d389be3089'>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9891583086388017"
     crossorigin="anonymous"></script>

  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4VRNKXVX3J"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-4VRNKXVX3J');
</script>

  <meta name="yandex-verification" content="139f2b0989f2c7f0" />
  
  <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "Roleplay-chat.com",
  "url": "https://roleplay-chat.com/",
  "description": "Create a character and start an anonymous no-login AI roleplay chat instantly.",
  "inLanguage": "en"
  }
</script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>No-login AI Roleplay | Roleplay-chat.com</title>
  <meta name="description" content="Create a character and start a no-login AI roleplay chat instantly. General and +18 Uncensored options available." />
  <meta name="robots" content="index,follow" />
  <meta name="theme-color" content="#000000" />

 <!-- Open Graph -->
<meta property="og:title" content="roleplay-chat.com | No-login AI Roleplay" />
<meta property="og:description" content="Create a character and start a no-login AI roleplay chat instantly." />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://roleplay-chat.com/" />
<meta property="og:image" content="https://roleplay-chat.com/og-image.jpg" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:image:type" content="image/jpeg" />

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="roleplay-chat.com | No-login AI Roleplay" />
<meta name="twitter:description" content="Create a character and start a no-login AI roleplay chat instantly." />
<meta name="twitter:image" content="https://roleplay-chat.com/og-image.jpg" />

 <!-- Favicon -->
<link rel="icon" href="/favicon.ico" sizes="any">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
<link rel="apple-touch-icon" sizes="180x180" href="/favicon-180.png">

  <!-- Rounded, commercial-free font -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />

  <!-- PayPal SDK (for in-page popup/overlay checkout). Note: The "buttons" flow opens PayPal in an overlay/mini-window. -->
  <script src="https://www.paypal.com/sdk/js?client-id=ASts4hxcd4-DkLEL8b-PbbawSaCD4G5pQiuJM9aZYawixhxWbQ2upSru10WQNZa4HzCqHUcGC8Z1RIrW&currency=USD&intent=capture"></script>

  <style>
    :root{
      --bg:#000;
      --fg:#fff;
      --muted:rgba(255,255,255,.75);
      --muted2:rgba(255,255,255,.55);
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.09);
      --border:rgba(255,255,255,.14);
      --focus:rgba(255,255,255,.25);
      --danger:#ff4d4d;
      --ok:#52ff9a;
      --shadow: 0 14px 36px rgba(0,0,0,.55);

      --radius: 16px;
      --radius2: 22px;

      /* default chat font color selection (preview) */
      --chatColor: #000000;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background: radial-gradient(900px 600px at 10% 0%, rgba(255,255,255,.06), transparent 55%),
                  radial-gradient(900px 600px at 90% 10%, rgba(255,255,255,.05), transparent 60%),
                  var(--bg);
      color: var(--fg);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      line-height: 1.35;
    }

    a{ color:inherit; }
    .wrap{
  min-height:100vh;
  display:flex;
  align-items:flex-start;   /* âœ… center â†’ flex-start */
  justify-content:center;
  padding: 18px 14px 26px;
}
    .shell{
      width: min(860px, 100%);
      display:grid;
      gap: 14px;
    }

    header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding: 4px 6px 0;
  gap: 12px;
}

    .logo{
      text-decoration: none;
      font-family: "Baloo 2", Inter, sans-serif;
      font-weight: 700;
      letter-spacing: .3px;
      font-size: clamp(16px, 3.6vw, 24px);
padding: 5px 8px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 10px 22px rgba(0,0,0,.45);
      user-select:none;
    }

    .logoRole{
  color: #ffcc00; /* dark yellow */
}


.logoDot{
  color: rgba(255,255,255,.95); /* keep white */
  font-size: 0.5em;            /* half size */
  vertical-align: baseline;
}

    .logo span{ opacity:.95; }
    .sub{
      text-align:center;
      margin-top: 0px;
      color: var(--muted);
      font-size: 12px;
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.05));
      border: 1px solid var(--border);
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .cardHead{
      padding: 8px 14px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
    }
    .cardHead h2{
      margin:0;
      font-size: 16px;
      letter-spacing:.2px;
    }
    .badge{
      font-size: 12px;
      color: var(--muted);
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.25);
      white-space:nowrap;
    }

    .cardBody{
  padding: 8px 12px 12px;
  display:flex;
  flex-direction:column;
  min-height: 0; /* ì¤‘ìš” */
}

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 18px;
    }

    @media (min-width: 720px){
      .grid{
        grid-template-columns: 1fr 1fr;
        gap: 12px 14px;
      }
      .span2{ grid-column: span 2; }
    }

    label{
  display:block;
  font-size: 15px;
  color: #ffcc00; /* â† ì—¬ê¸° */
  margin: 0 0 6px;
  font-weight: 700; /* ì„ íƒ: ë” ì˜ ë³´ì´ê²Œ */
}

    input, select, textarea{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.45);
      color: var(--fg);
      outline: none;
      transition: .15s ease;
      font-size: 14px;
    }
    textarea{ resize: vertical; min-height: 92px; max-height: 240px; }
    input:focus, select:focus, textarea:focus{
      border-color: rgba(255,255,255,.30);
      box-shadow: 0 0 0 4px rgba(255,255,255,.08);
    }

    .row{
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap:wrap;
    }

    .pillGroup{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
    }
    .pill{
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.35);
      border-radius: 999px;
      padding: 10px 12px;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap: 8px;
      user-select:none;
      transition:.15s ease;
    }
    .pill:hover{ background: rgba(255,255,255,.06); }
    .pill input{ width:auto; margin:0; }
    .pill small{
  color: #ffffff;
  font-weight: 700;
}
    .hint{
      margin-top: 6px;
      font-size: 12px;
      color: var(--muted2);
    }

    .colors{
      display:grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 10px;
    }
    @media (min-width:720px){
      .colors{ grid-template-columns: repeat(8, minmax(0, 1fr)); }
    }
    .swatch{
      height: 44px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      cursor:pointer;
      position:relative;
      overflow:hidden;
      transition:.15s ease;
    }
    .swatch:hover{ transform: translateY(-1px); }
    .swatch[aria-selected="true"]{
      outline: 3px solid rgba(255,255,255,.18);
      box-shadow: 0 0 0 4px rgba(255,255,255,.06);
    }
    .swatch .check{
      position:absolute;
      inset:auto 8px 8px auto;
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(0,0,0,.55);
      border: 1px solid rgba(255,255,255,.14);
      display:none;
    }
    .swatch[aria-selected="true"] .check{ display:block; }

    .preview{
      display:flex;
      gap: 12px;
      align-items:center;
      padding: 12px;
      border-radius: 16px;
      border: 1px dashed rgba(255,255,255,.18);
      background: rgba(0,0,0,.25);
    }

    /* avatar X (clear) button */
.avatar{
  position: relative; /* ë²„íŠ¼ í¬ì§€ì…”ë‹ì„ ìœ„í•´ */
}

.avatarClear{
  position: absolute;
  top: 6px;
  right: 6px;
  width: 22px;
  height: 22px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.18);
  background: rgba(0,0,0,.55);
  color: rgba(255,255,255,.9);
  font-size: 16px;
  line-height: 1;
  display: none;        /* ê¸°ë³¸ ìˆ¨ê¹€ */
  align-items: center;
  justify-content: center;
  cursor: pointer;
  padding: 0;
}

.avatarClear:hover{
  background: rgba(0,0,0,.75);
}

/* ëª¨ë°”ì¼ íƒ­í•˜ê¸° í¸í•˜ê²Œ */
.avatarClear:active{
  transform: scale(0.96);
}
    
    .avatar{
      width: 52px; height: 52px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      flex: 0 0 auto;
    }
    .avatar img{ width:100%; height:100%; object-fit:cover; display:block; }
    .bubble{
      flex:1;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      font-size: 13px;
      color: var(--muted);
    }
    .bubble b{
      color: var(--fg);
      font-weight: 700;
      font-family: "Baloo 2", Inter, sans-serif;
    }
    .bubble .accent{
      color: var(--fg);
      font-weight: 700;
      text-decoration: underline;
      text-decoration-thickness: 2px;
      text-underline-offset: 3px;
      text-decoration-color: var(--chatColor);
    }

    .actions{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      margin-top: 14px;
    }

    .btn{
      width: 100%;
      padding: 14px 14px;
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 16px;
      background: rgba(255,255,255,.10);
      color: var(--fg);
      font-weight: 800;
      cursor:pointer;
      transition:.15s ease;
      font-size: 15px;
      letter-spacing:.2px;
    }
    .btn:hover{ background: rgba(255,255,255,.14); transform: translateY(-1px); }
    .btn:active{ transform: translateY(0px); }

    .btnPrimary{
  background: #e0b400;
  border: 1px solid #c9a200;
  color: #000;
  font-weight: 800;
}

    .note{
      font-size: 12px;
      color: var(--muted2);
      margin: 10px 2px 0;
    }

    /* In-page "Next page" view (no full page load) */
    .view{ display:none; }
    .view.active{ display:block; }

    /* Chat placeholder */
    .chatShell{
  display:flex;
  flex-direction:column;
  gap: 8px;
  min-height: 0; /* ì¤‘ìš”: flex ì•ˆì—ì„œ overflowê°€ ì œëŒ€ë¡œ ë™ì‘ */
}

    .chip{
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--muted);
      white-space:nowrap;
    }
    .chatBox{
  flex: 1 1 auto;
  min-height: 0;
  border-radius: 18px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.35);
  padding: 14px;
  padding-bottom: calc(14px + env(safe-area-inset-bottom));
  overflow:auto;
  overscroll-behavior: contain;
  -webkit-overflow-scrolling: touch;
}
    .chatMsg{
      display:flex;
      gap: 10px;
      margin-bottom: 10px;
      align-items:flex-start;
    }

    /* (4) ADDED: user messages on the right */
    .chatMsg.me{
      flex-direction: row-reverse;
    }
    .chatMsg.me .text{
      text-align: right;
    }

    .chatMsg .who{
      width: 38px; height: 38px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      flex: 0 0 auto;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: 12px;
      color: var(--muted);
    }
    .chatMsg .who img{ width:100%; height:100%; object-fit:cover; display:block; }
    .chatMsg .text{
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      max-width: 78%;
      color: var(--fg);
      font-size: 14px;
    }
    .chatMsg .text .name{
      font-weight: 800;
      font-family: "Baloo 2", Inter, sans-serif;
      color: var(--chatColor);
    }
   
    .chatInput{
  flex: 1 1 auto;
  min-width: 0;          /* ì¤‘ìš”: ì‘ì€ í™”ë©´ì—ì„œ ë²„íŠ¼ ë°€ë¦¬ì§€ ì•Šê²Œ */
  height: 42px;          /* sendBtnê³¼ ë™ì¼ */
  padding: 0 10px;       /* ì„¸ë¡œ íŒ¨ë”© ì œê±°, ë†’ì´ë¡œ ê´€ë¦¬ */
  border-radius: 14px;
}

.sendBtn{
  flex: 0 0 42px;        /* ì¤„ë°”ê¿ˆ ë°©ì§€ */
  height: 42px;
  border-radius: 14px;
}

    /* Paywall modal */
    .modalOverlay{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.72);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px 14px;
      z-index: 9999;
    }
    .modalOverlay.active{ display:flex; }
    .modal{
      width: min(520px, 100%);
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(10,10,10,.92);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .modalHeader{
      padding: 14px 16px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
    }
    .modalHeader h3{
      margin:0;
      font-size: 15px;
      letter-spacing:.2px;
    }
    .xBtn{
      border:none;
      background: rgba(255,255,255,.08);
      color: var(--fg);
      border-radius: 12px;
      padding: 8px 10px;
      cursor:pointer;
      border: 1px solid rgba(255,255,255,.14);
    }

/* âœ… Unlock ë²„íŠ¼: í•«í•‘í¬ */
#unlockBtn{
  background: #ff4fd8;
  border: 1px solid #ff2fce;
  color: #000;
  font-weight: 900;
}
#unlockBtn:hover{ background:#ff6fe1; }
#unlockBtn:active{ background:#ff2fce; }

    /* New ë²„íŠ¼ë§Œ ì§„í•œ ë…¸ë€ìƒ‰ */
#resetBtn{
  background: #e0b400;
  border: 1px solid #c9a200;
  color: #000;
  font-weight: 800;
}

#resetBtn:hover{
  background: #f0c800;
}

#resetBtn:active{
  background: #cfa600;
}

    .modalBody{ padding: 14px 16px 16px; }
    .warn{
      font-size: 12px;
      color: var(--muted);
      margin: 0 0 10px;
    }
    .error{
      margin-top: 10px;
      font-size: 12px;
      color: var(--danger);
      display:none;
    }
    .ok{
      margin-top: 10px;
      font-size: 12px;
      color: var(--ok);
      display:none;
    }

    .shareBtn{
  width: 36px;
  height: 36px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.06);
  box-shadow: var(--shadow);
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  transition:.15s ease;
  flex: 0 0 auto;
}
.shareBtn:hover{ background: rgba(255,255,255,.10); transform: translateY(-1px); }
.shareBtn:active{ transform: translateY(0px); }

.shareBtn svg{
  width: 16px;
  height: 16px;
  fill: none;
  stroke: rgba(255,255,255,.92);
  stroke-width: 2;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.infoMenu{
  position: absolute;
  top: calc(100% + 8px);
  right: 0;
  min-width: 220px;
  background: rgba(10,10,10,.92);
  border: 1px solid rgba(255,255,255,.16);
  border-radius: 14px;
  box-shadow: var(--shadow);
  padding: 6px;
  display: none;
  z-index: 99999;
}

.infoMenu.active{ display: block; }

.infoMenu a{
  display: block;
  padding: 10px 10px;
  border-radius: 12px;
  text-decoration: none;
  color: rgba(255,255,255,.92);
  font-size: 13px;
}

.infoMenu a:hover{
  background: rgba(255,255,255,.08);
}

    .chatFooter{
  text-align:center;
  font-size: 10px;
  color: rgba(255,255,255,.45);
  padding: 2px 0 0px;
}
    
    footer{
      text-align:center;
      font-size: 12px;
      color: rgba(255,255,255,.45);
      padding: 10px 0 4px;
    }

    /* =========================
   CHAT MODE: TOP FIXED + INPUT FIXED + ONLY chatBox scroll
   (PASTE AT VERY BOTTOM)
   ========================= */

/* ì±„íŒ… í™”ë©´ì—ì„œëŠ” í˜ì´ì§€ ìŠ¤í¬ë¡¤ ìì²´ë¥¼ ë§‰ì•„ë²„ë¦¼ */
body.chatMode{
  height: 100dvh;
  overflow: hidden;
}

/* chatHead(íƒ€ì´í‹€+ë©”ë‰´) ì„¸ë¡œ ìŠ¤íƒ ìœ ì§€ */
#viewChat .cardHead.chatHead{
  display: flex;
  flex-direction: column;
  align-items: stretch;
  gap: 10px;
}

/* ì±„íŒ… í™”ë©´ì€ ë‚¨ì€ ë†’ì´ë¥¼ ê½‰ ë¨¹ëŠ” flex ë ˆì´ì•„ì›ƒ */
body.chatMode .wrap{
  height: 100dvh;
  padding-top: 0px; /* ì›ë˜ 18px â†’ ì¡°ê¸ˆ ì¤„ì´ê¸° */
}

body.chatMode .shell{
  height: 100%;
}

/* viewChat ì¹´ë“œê°€ í™”ë©´ ë‚¨ì€ ë†’ì´ë¥¼ ë¨¹ê³  */
body.chatMode #viewChat.active{
  flex: 1 1 auto;
  min-height: 0;
  display: flex;
  flex-direction: column;
}

/* cardBodyë„ column flexë¡œ */
body.chatMode #viewChat.active .cardBody{
  flex: 1 1 auto;
  min-height: 0;
  display: flex;
  flex-direction: column;
  padding: 8px 12px 12px; /* ê¸°ì¡´ ëŠë‚Œ ìœ ì§€ */
}

/* chatShell: ì±„íŒ…ë°•ìŠ¤(ìŠ¤í¬ë¡¤) + ì…ë ¥ì°½(ê³ ì •) êµ¬ì¡° */
body.chatMode #viewChat .chatShell{
  flex: 1 1 auto;
  min-height: 0;
  display: flex;
  flex-direction: column;
}

/* âœ… ê¸°ë³¸(í‚¤ë³´ë“œ ë‚´ë ¤ê°): ì•„ë˜ ì—¬ë°± ë„‰ë„‰í•˜ê²Œ */
body.chatMode #viewChat .chatBox{
  flex: 1 1 auto;
  min-height: 0;
  overflow: auto;

  /* ê¸°ë³¸ì€ ë„‰ë„‰í•˜ê²Œ: ë§ˆì§€ë§‰ ë§í’ì„  í•˜ë‹¨ í…Œë‘ë¦¬ê¹Œì§€ í™•ì‹¤íˆ ë³´ì´ê²Œ */
  padding-bottom: calc(var(--controlsH) + 20px + env(safe-area-inset-bottom));

  /* ìŠ¤í¬ë¡¤ì´ "ë§ˆì§€ë§‰ ìš”ì†Œ"ë¥¼ ì–´ë””ê¹Œì§€ ì˜¬ë ¤ì¤„ì§€ íŒíŠ¸ (ì²´ê° ì¢‹ì•„ì§) */
  scroll-padding-bottom: calc(var(--controlsH) + 20px + env(safe-area-inset-bottom));
}

    /* âœ… í‚¤ë³´ë“œ ì˜¬ë¼ì˜´: ì—¬ë°± ì¡°ê¸ˆ ì¤„ì´ê¸° */
body.chatMode.kbUp #viewChat .chatBox{
  padding-bottom: calc(var(--controlsH) + env(safe-area-inset-bottom));
  scroll-padding-bottom: calc(var(--controlsH) + env(safe-area-inset-bottom));
}

/* âœ… ì…ë ¥ì°½: ì§„ì§œ í•˜ë‹¨ ê³ ì • + í‚¤ë³´ë“œ ì˜¬ë¼ì˜¤ë©´ ê°™ì´ ìƒìŠ¹ */
body.chatMode #viewChat .chatControls{
  position: fixed;
  left: 50%;
  transform: translateX(-50%); /* âœ… ê°€ìš´ë° ì •ë ¬(ê³ ì •ìš”ì†Œì—ì„œ margin auto ì•ˆ ë¯¿ê¸°) */
  width: min(860px, 100%);
  bottom: 0;                  /* âœ… ë¬´ì¡°ê±´ ìµœí•˜ë‹¨ */

  z-index: 999;

  display:flex;
  gap: 10px;
  align-items: center;

  padding: 12px 14px calc(12px + env(safe-area-inset-bottom));
  background: rgba(0,0,0,.65);
  backdrop-filter: blur(10px);
}


/* chatFooterëŠ” ì…ë ¥ì°½ ì•„ë˜ë¡œ ë‚´ë ¤ê°€ë©´ ì•ˆ ë³´ì¼ ìˆ˜ ìˆìœ¼ë‹ˆ,
   ì±„íŒ… ëª¨ë“œì—ì„œëŠ” ì‚´ì§ë§Œ ì•„ë˜ ì—¬ë°± ì¤„ì´ê¸°(í…ìŠ¤íŠ¸ëŠ” ìœ ì§€) */
body.chatMode #viewChat .chatFooter{
  padding: 2px 0 0;
}

    body.chatMode .sub{
  display: none !important;
}

.shareWrap{
  display: flex;
  align-items: center;
  gap: 6px;               /* â† ì—¬ê¸°ì„œ ê±°ë¦¬ ë¯¸ì„¸ì¡°ì • */
}

.bookmarkHint{
  font-size: 10px;
  line-height: 1.1;
  text-align: right;      /* ë²„íŠ¼ ìª½ìœ¼ë¡œ ë¶™ëŠ” ëŠë‚Œ */
  color: rgba(255,255,255,.55);
  user-select: none;
  white-space: nowrap;
}

    .highlightCTA{
  color: #e0b400;
  font-weight: 800;
}

    /* âœ… Info ë²„íŠ¼: ë” ê°•í•œ ë…¸ë€ ê¸€ë¡œìš° */
#infoBtn{
  border-color: rgba(255, 204, 0, .55);
  box-shadow:
    0 0 0 1px rgba(255, 204, 0, .25),
    0 0 18px rgba(255, 204, 0, .35),
    0 0 34px rgba(255, 204, 0, .22),
    var(--shadow);
}

#infoBtn:hover{
  border-color: rgba(255, 204, 0, .75);
  box-shadow:
    0 0 0 1px rgba(255, 204, 0, .35),
    0 0 22px rgba(255, 204, 0, .45),
    0 0 44px rgba(255, 204, 0, .28),
    var(--shadow);
}


    .pill.recommend{
  border-color: #ffcc00;
  box-shadow:
    0 0 0 1px rgba(255,204,0,.35),
    0 0 18px rgba(255,204,0,.45),
    0 0 36px rgba(255,204,0,.25);
  background: rgba(255,204,0,.08);
}

.pillTag{
  margin-left: 6px;
  font-size: 10px;
  font-weight: 900;
  color: #000;
  background: #ff3b3b;
  padding: 2px 6px;
  border-radius: 999px;
}

    

  </style>
</head>

<body>
  <div class="wrap">
    <div class="shell">

<header>
  <!-- âœ… 2ì¤„ ìŠ¤íƒ ì»¨í…Œì´ë„ˆ -->
  <div style="display:block; width:100%;">

    <!-- âœ… 1ì¤„: ê¸°ì¡´ í—¤ë” ë‚´ìš© (ê·¸ëŒ€ë¡œ, ë‹¨ 1ê¸€ìë„ ìˆ˜ì •X) -->
    <div style="display:flex; align-items:center; justify-content:space-between; width:100%;">
      <a href="https://roleplay-chat.com" target="_blank" rel="noopener noreferrer" class="logo">
        <span class="logoRole">Roleplay-chat</span><span class="logoDot">.com</span>
      </a>

      <!-- âœ… ê³µìœ  ì˜ì—­ ë¬¶ê¸° -->
      <div class="shareWrap" style="position:relative;">
        <div class="bookmarkHint">
          Bookmark<br>&amp; Share
        </div>

        <button class="shareBtn" id="shareBtn" type="button" aria-label="Share">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <circle cx="18" cy="5" r="3"></circle>
            <circle cx="6" cy="12" r="3"></circle>
            <circle cx="18" cy="19" r="3"></circle>
            <path d="M8.6 13.5l6.8 3.9"></path>
            <path d="M15.4 6.6L8.6 10.5"></path>
          </svg>
        </button>

        <!-- âœ… ìƒˆ Info ë²„íŠ¼(ìµœìš°ì¸¡) -->
        <button class="shareBtn" id="infoBtn" type="button" aria-label="Info" title="Info">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <circle cx="12" cy="12" r="9"></circle>
            <path d="M12 10.5v6"></path>
            <circle cx="12" cy="7.5" r="1"></circle>
          </svg>
        </button>

        <!-- âœ… Info ë©”ë‰´ -->
        <div class="infoMenu" id="infoMenu" role="menu" aria-label="Info menu">
          <a href="https://chat-with-stranger.com" target="_blank" rel="noopener noreferrer" style="color: #FF69B4; font-weight: bold; text-decoration: none;">Chat with stranger</a>
          <a href="https://roleplay-chat.com/human" target="_blank" rel="noopener noreferrer" style="color: #FFD700; font-weight: bold; text-decoration: none;">Chat with real human</a>
          <a href="https://roleplay-chat.com" target="_blank" rel="noopener noreferrer">Home</a>
          <a href="https://roleplay-chat.com/how" target="_blank" rel="noopener noreferrer">How to use</a>
          <a href="https://roleplay-chat.com/about" target="_blank" rel="noopener noreferrer">About</a>
          <a href="https://roleplay-chat.com/policy" target="_blank" rel="noopener noreferrer">Policy</a>
          <a href="https://roleplay-chat.com/faq" target="_blank" rel="noopener noreferrer">FAQ</a>
          <a href="mailto:showmetheaitools@gmail.com">Contact</a>
          <a href="https://2048global.com" target="_blank" rel="noopener noreferrer" style="color: #FFD700; font-weight: bold; text-decoration: none;">Game</a>
          <a href="https://roleplay-chat.com/VPN" target="_blank" rel="noopener noreferrer" style="color: #FFD700; font-weight: bold; text-decoration: none;">VPN</a>
        </div>
      </div>
    </div>

    <!-- âœ… 2ì¤„: Chatango ë¼ì¸(ì˜¤ë¥¸ìª½) -->
    <div align="right">
      <sup><a href="https://roleplay-chat.com/human" target="_blank" style="text-decoration:none">
        <font size="1" color="#ffcc00"><b>Live user chat</b></font>
      </a></sup><script id="cid0020000430144912743" data-cfasync="false" async
        src="https://st.chatango.com/js/gz/emb.js"
        style="width:200px;height:300px;">
        {"handle":"roleplay-chat-com","arch":"js","styles":{"a":"000000","b":100,"c":"FFFFFF","d":"FFFFFF","k":"000000","l":"000000","m":"000000","n":"FFFFFF","p":"10","q":"000000","r":100,"cv":1,"cvfntsz":"10px","cvbg":"000000","cvfg":"ffcc00","cvw":49,"cvh":18}}
      </script>
    </div>

  </div>
</header>

      <div class="sub">Create the most human-like character, Enjoy roleplay.<br>no-login. Private & Safe.</div>

      <!-- VIEW 1: Character setup -->
      <section id="viewSetup" class="card view active" aria-label="Character creation">
        <div class="cardHead">
          <h2>Character Setup</h2>
          </div>

        <div class="cardBody">
          <form id="characterForm" class="grid" autocomplete="off">
            <div>
              <label for="name">Character Name <span style="color: #fff;">(required)</span></label>
              <input id="name" name="name" type="text" required maxlength="40" placeholder="e.g., Luna, Detective Gray, Captain Nova" />
            </div>

            <div class="span2">
              <label for="avatar">Profile Photo <span style="color: rgba(255,255,255,.55);">(optional)</span></label>
              <input id="avatar" name="avatar" type="file" accept="image/*" />
              <div class="hint">PNG/JPG/WebP recommended.</div>
            </div>

            <div class="span2">
              <div class="preview" aria-label="Preview">
                <div class="avatar" id="avatarPreview">
  <button type="button" class="avatarClear" id="avatarClearBtn" aria-label="Remove photo" title="Remove">Ã—</button>
  <span>ğŸ™‚</span>
</div>
                <div class="bubble">
                  <div><b>Preview</b></div>
                  <div style="margin-top:6px;">
                    <span class="accent" id="namePreview" style="--chatColor: var(--chatColor);">Your character</span>
                    <span style="color: var(--muted2);"> will appear like this in chat.</span>
                  </div>
                </div>
              </div>
            </div>

            <div>
  <label for="nickname">What should the character call you?</label>
  <input id="nickname" name="nickname" type="text" maxlength="30" placeholder="e.g., babe, buddy, captain, darling" />
</div>


            <div>
              <label for="age">Age</label>
              <select id="age" name="age" required></select>
            </div>

            <div>
              <label for="gender">Gender</label>
              <select id="gender" name="gender" required>
                <option value="Man">Man</option>
                <option value="Woman">Woman</option>
                <option value="None">None</option>
                <option value="Gay">Gay</option>
                <option value="Lesbian">Lesbian</option>
                <option value="Bi">Bi</option>
                <option value="Trans man">Trans man</option>
                <option value="Trans woman">Trans woman</option>
              </select>
            </div>

            <div>
              <label for="language">Language</label>
              <select id="language" name="language" required>
                <option value="English">English</option>
                <option value="Spanish">EspaÃ±ol</option>
                <option value="Chinese">ä¸­æ–‡</option>
                <option value="French">FranÃ§ais</option>
                <option value="Portuguese">PortuguÃªs</option>
                <option value="German">Deutsch</option>
                <option value="Japanese">æ—¥æœ¬èª</option>
                <option value="Italian">Italiano</option>
                <option value="Korean">í•œêµ­ì–´</option>
                <option value="Dutch">Nederlands</option>
                <option value="Russian">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                <option value="Arabic">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                <option value="Swedish">Svenska</option>
                <option value="Norwegian">Norsk</option>
                <option value="Danish">Dansk</option>
              </select>
            </div>

            <div class="span2">
  <label>Height & Weight</label>

  <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 12px;">
    <!-- Height -->
    <div>
      <label for="heightUnit" style="font-size:12px; color: var(--muted); font-weight:600;">Height unit</label>
      <select id="heightUnit" name="heightUnit" required>
        <option value="cm">cm</option>
        <option value="ft">ft/in</option>
      </select>
    </div>

    <div id="heightCmWrap">
      <label for="heightCm" style="font-size:12px; color: var(--muted); font-weight:600;">Height (cm)</label>
      <input id="heightCm" type="number" min="50" max="260" placeholder="e.g., 170" />
    </div>

    <div id="heightFtWrap" style="display:none;">
      <label style="font-size:12px; color: var(--muted); font-weight:600;">Height (ft/in)</label>
      <div class="row">
        <input id="heightFt" type="number" min="3" max="8" placeholder="ft" />
        <input id="heightIn" type="number" min="0" max="11" placeholder="in" />
      </div>
    </div>

    <!-- Weight -->
    <div>
      <label for="weightUnit" style="font-size:12px; color: var(--muted); font-weight:600;">Weight unit</label>
      <select id="weightUnit" name="weightUnit" required>
        <option value="kg">kg</option>
        <option value="lb">lb</option>
      </select>
    </div>

    <div>
      <label for="weightValue" style="font-size:12px; color: var(--muted); font-weight:600;">Weight</label>
      <input id="weightValue" type="number" min="20" max="500" placeholder="e.g., 60" />
    </div>
  </div>

  <div class="hint">Used as character traits for roleplay prompts.</div>
</div>


            <div>
  <label for="mbti">MBTI</label>
  <select id="mbti" name="mbti" required>
    <option value="NONE" selected>Not sure</option>
    <option value="INTJ">INTJ</option><option value="INTP">INTP</option>
    <option value="ENTJ">ENTJ</option><option value="ENTP">ENTP</option>
    <option value="INFJ">INFJ</option><option value="INFP">INFP</option>
    <option value="ENFJ">ENFJ</option><option value="ENFP">ENFP</option>
    <option value="ISTJ">ISTJ</option><option value="ISFJ">ISFJ</option>
    <option value="ESTJ">ESTJ</option><option value="ESFJ">ESFJ</option>
    <option value="ISTP">ISTP</option><option value="ISFP">ISFP</option>
    <option value="ESTP">ESTP</option><option value="ESFP">ESFP</option>
  </select>
</div>


            <div class="span2">
              <label for="personality">Personality</label>
              <textarea id="personality" name="personality" maxlength="300" placeholder="Describe their personality, tone, quirks, and boundaries... the more specific, the more fun and alive they become."></textarea>
              <div class="hint"><span id="pCount">0</span>/300</div>
            </div>

            <div class="span2">
              <label for="scenario">Place & Situation</label>
              <textarea id="scenario" name="scenario" maxlength="300" placeholder="Where are you? What's happening? Set the scene... the more specific, the more fun and alive they become."></textarea>
              <div class="hint"><span id="sCount">0</span>/300</div>
            </div>

            <div class="span2">
              <label>Font Color</label>
              <div class="colors" id="colorGrid" role="listbox" aria-label="Font color options"></div>
              <div class="hint">This color will be used to display the character name in chat.</div>
            </div>


            <div class="span2">
              <label>Chat Option</label>
              <div class="pillGroup" role="radiogroup" aria-label="Chat option">
                <label class="pill">
                  <input type="radio" name="tier" value="general" checked />
                  <div>
                    <div><b>General</b> <small>(free)</small></div>
                  </div>
                </label>

                <label class="pill">
                  <input type="radio" name="tier" value="uncensored" />
                  <div>
                    <div>
      <b>+18 Uncensored</b>
      <small style="opacity:.65; font-size:10px; margin:0 4px;"> + high performance</small>
      <small>($2)</small>
    </div>
                  </div>
                </label>

<label class="pill recommend">
  <input type="radio" name="tier" value="imagechat" />
  <div>
    <div>
      <b>ğŸ”¥ +18 Uncensored <span style="color:#ff3b3b;">Image</span> Chat</b>
      <small class="pillTag">Most Popular</small>
      <small>($6.9)</small>
    </div>
  </div>
</label>

              </div>
            </div>

            <div class="note">
  No login. Your character is kept per browser tab.<br />
  <span style="opacity:.8;">
    The conversation will remain available for the lifetime of this browser tab, as long as it stays open. This is an anonymous chat and is not stored on the server.
  </span>
</div>


              <div class="actions">
                <button id="createBtn" class="btn btnPrimary" type="submit">Create</button>
              </div>
          </form>
        </div>
      </section>

      <!-- VIEW 2: Chat (placeholder) -->
     <section id="viewChat" class="card view" aria-label="Chat">
 <div class="cardHead chatHead">
  <h2 id="chatTitle">Chat</h2>

  <div class="row" style="gap:10px;">
    <button class="xBtn" id="resetBtn" type="button">New character</button>
    <button class="xBtn" id="gameBtn" type="button">Game</button>
    <button class="xBtn" id="vpnBtn" type="button">VPN</button>
    <button class="xBtn" id="unlockBtn" type="button" style="display:none;">Unlock</button>
  </div>
</div>

  <div class="cardBody">
    <div class="chatShell">
      <!-- âŒ ì—¬ê¸° ìˆë˜ chatTop ë¸”ë¡ì€ ì œê±°ë¨ -->

      <div class="chatBox" id="chatBox"></div>

      <div class="chatControls">
        <input class="chatInput" id="chatInput" type="text" placeholder="Type a message ..." />
        <button class="sendBtn" id="sendBtn" type="button" title="Send">â¤</button>
      </div>

      <div class="chatFooter">
        Convos available while this tab is open
      </div>
    </div>
  </div>
</section>


    </div>
  </div>

  <!-- Paywall Modal -->
  <div id="payModal" class="modalOverlay" role="dialog" aria-modal="true" aria-label="+18 Uncensored payment">
    <div class="modal">
      <div class="modalHeader">
        <h3 id="payTitle">Unlock +18 Uncensored ($2)</h3>
        <button class="xBtn" id="closePay" type="button">Close</button>
      </div>
      <div class="modalBody">
        <p class="warn">
          - <span class="highlightCTA">Unlock <b id="payCharName">your character</b></span> and unleash yourself.<br>
          - <span class="highlightCTA">Fully uncensored</span> experience.<br>
          - <span class="highlightCTA">Longer replies. Richer memory.</span><br>
          - <span class="highlightCTA">More detail. More tension.</span><br>
          - Secure one-time payment.<br>
          - Unlimited access as long as this tab stays open.<br>
          - No-login. Private and anonymous.<br>
          - Payment = Auto age verification.<br>
          - Shows as 'Playing game' on payment statement.<br>
          - <span class="highlightCTA">Start now. Instant access.</span>
        </p>

        <div id="paypalButtons"></div>

        <div class="ok" id="payOk">Payment successful. Entering chatâ€¦</div>
        <div class="error" id="payErr">Payment failed or cancelled. Please try again.</div>
      </div>
    </div>
  </div>

<!-- Image Chat Paywall Modal (NEW, separate) -->
<div id="imgPayModal" class="modalOverlay" role="dialog" aria-modal="true" aria-label="Image chat payment">
  <div class="modal">
    <div class="modalHeader">
      <h3 id="imgPayTitle">Ucensored Image Chat ($6.9)</h3>
      <button class="xBtn" id="closeImgPay" type="button">Close</button>
    </div>
    <div class="modalBody">
      <p class="warn" id="imgPayDesc">
          - <span class="highlightCTA">Let your character come alive.</span><br>
          - <span class="highlightCTA">Enter a New world.</span><br>
          - <span class="highlightCTA">Real-time Image generating chat.</span><br>
          - <span class="highlightCTA">Available for 24hrs.</span> (Time limit)<br>
          - <span class="highlightCTA">Unlimited image generation during chat</span><br>
          - <span class="highlightCTA">Fully uncensored</span><br>
           - Unlimited access as long as this tab stays open.<br>
          - Images are generated matching the roleplay context.<br>
          - Longer replies. Richer memory.<br>
          - More detail. More tension.<br>
          - Secure one-time payment.<br>
          - No-login. Private and anonymous.<br>
          - Payment = Auto age verification.<br>
          - Shows as 'Playing game' on payment statement.<br>
          - <span class="highlightCTA">Start now. Instant access.</span>
      </p>

      <div id="imgPaypalButtons"></div>

      <div class="ok" id="imgPayOk">Payment successful. Entering image chatâ€¦</div>
      <div class="error" id="imgPayErr">Payment failed or cancelled. Please try again.</div>
    </div>
  </div>
</div>


  <script>
    // --------- Helpers
    const $ = (q) => document.querySelector(q);
    const $$ = (q) => Array.from(document.querySelectorAll(q));

    const DEFAULT_TITLE = "roleplay-chat.com | No-login AI Roleplay"; // (3) ADDED
    document.title = DEFAULT_TITLE; // (3) ADDED

    const viewSetup = $("#viewSetup");
    const viewChat = $("#viewChat");

    const form = $("#characterForm");
    const nameInput = $("#name");
    const personality = $("#personality");
    const scenario = $("#scenario");
    const pCount = $("#pCount");
    const sCount = $("#sCount");

    const ageSelect = $("#age");
    const avatarInput = $("#avatar");
    const avatarPreview = $("#avatarPreview");
    const avatarClearBtn = $("#avatarClearBtn");
    const namePreview = $("#namePreview");

    const payModal = $("#payModal");
    const closePay = $("#closePay");
    const payOk = $("#payOk");
    const payErr = $("#payErr");

    const imgPayModal = $("#imgPayModal");
    const closeImgPay = $("#closeImgPay");
    const imgPayOk = $("#imgPayOk");
    const imgPayErr = $("#imgPayErr");

    const modelBadge = $("#modelBadge");
const chipName = $("#chipName");
const chipLang = $("#chipLang");
const chipTier = $("#chipTier");
const chatName = $("#chatName");
const chatAvatar = $("#chatAvatar");
    
    const resetBtn = $("#resetBtn");
    const gameBtn = $("#gameBtn");
    const vpnBtn = $("#vpnBtn");
    const unlockBtn = $("#unlockBtn");

    const STORAGE_KEY = "roleplay-chat_session_v1";
    const HISTORY_KEY = "roleplay-chat_history_v1";
    const PENDING_KEY = "roleplay-chat_pending_session_v1";
    const IMAGECHAT_PAID_KEY = "roleplay-chat_imagechat_paid_v1";

    // Share button
const shareBtn = document.querySelector("#shareBtn");
if (shareBtn){
  shareBtn.addEventListener("click", async () => {
    const url = window.location.href;
    try{
      if (navigator.share){
        await navigator.share({ title: document.title, url });
      }else{
        await navigator.clipboard.writeText(url);
        // optional tiny feedback
        shareBtn.title = "Copied!";
        setTimeout(() => (shareBtn.title = "Share"), 900);
      }
    }catch(e){
      // user cancelled or blocked
    }
  });
}

    // Info button dropdown âœ… (ì—¬ê¸°!)
const infoBtn = document.querySelector("#infoBtn");
const infoMenu = document.querySelector("#infoMenu");

function closeInfoMenu(){
  if (infoMenu) infoMenu.classList.remove("active");
}

if (infoBtn && infoMenu){
  infoBtn.addEventListener("click", (e) => {
    e.stopPropagation();
    infoMenu.classList.toggle("active");
  });

  infoMenu.addEventListener("click", (e) => {
    e.stopPropagation();
  });

  document.addEventListener("click", closeInfoMenu);

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") closeInfoMenu();
  });
}
    
    // Colors: bright & readable colors
    const colorOptions = [
      { name: "White", value: "#ffffff" },
      { name: "Sky Blue", value: "#5cc8ff" },
      { name: "Mint", value: "#5cffc4" },
      { name: "Lime", value: "#b8ff5c" },
      { name: "Yellow", value: "#ffd95c" },
      { name: "Orange", value: "#ff9f5c" },
      { name: "Pink", value: "#ff7ac8" },
      { name: "Violet", value: "#b68cff" },
    ];

    let selectedColor = colorOptions[4].value;
    let selectedColorName = colorOptions[4].name;

    // --------- Init: age options 18..200
    for (let i = 18; i <= 200; i++){
      const opt = document.createElement("option");
      opt.value = String(i);
      opt.textContent = String(i);
      ageSelect.appendChild(opt);
    }
    ageSelect.value = "18";

    // --------- Init: colors grid
    const colorGrid = $("#colorGrid");
    function renderColors(){
      colorGrid.innerHTML = "";
      colorOptions.forEach((c, idx) => {
        const div = document.createElement("div");
        div.className = "swatch";
        div.style.background = c.value;
        div.setAttribute("role", "option");
        div.setAttribute("tabindex", "0");
        div.setAttribute("aria-label", c.name);
        div.setAttribute("aria-selected", String(c.value === selectedColor));
        div.dataset.value = c.value;
        div.dataset.name = c.name;
        div.innerHTML = `<div class="check">âœ“</div>`;
        div.addEventListener("click", () => chooseColor(c.value, c.name));
        div.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " "){
            e.preventDefault();
            chooseColor(c.value, c.name);
          }
        });
        colorGrid.appendChild(div);
      });
      applyPreviewColor();
    }
    function chooseColor(val, name){
      selectedColor = val;
      selectedColorName = name;
      $$("#colorGrid .swatch").forEach(el => el.setAttribute("aria-selected", String(el.dataset.value === selectedColor)));
      applyPreviewColor();
    }
    function applyPreviewColor(){
      document.documentElement.style.setProperty("--chatColor", selectedColor);
      namePreview.textContent = nameInput.value.trim() || "Your character";
    }
    renderColors();

    const heightUnit = $("#heightUnit");
const heightCmWrap = $("#heightCmWrap");
const heightFtWrap = $("#heightFtWrap");

heightUnit.addEventListener("change", () => {
  const isCm = heightUnit.value === "cm";
  heightCmWrap.style.display = isCm ? "block" : "none";
  heightFtWrap.style.display = isCm ? "none" : "block";
});

    // --------- Counters
    function updateCounts(){
      pCount.textContent = String(personality.value.length);
      sCount.textContent = String(scenario.value.length);
    }
    personality.addEventListener("input", updateCounts);
    scenario.addEventListener("input", updateCounts);
    updateCounts();

    // --------- Name preview
    nameInput.addEventListener("input", applyPreviewColor);

    async function resizeImageToDataURL(file, {
  maxSize = 512,      // ê°€ë¡œ/ì„¸ë¡œ ìµœëŒ€ í”½ì…€
  quality = 0.78,     // JPEG í’ˆì§ˆ (0~1)
  mime = "image/jpeg" // ì €ì¥ í¬ë§·
} = {}){
  // ì´ë¯¸ì§€ ë””ì½”ë“œ (iOS í˜¸í™˜ ìœ„í•´ createImageBitmap ëŒ€ì‹  Image ì‚¬ìš©)
  const img = new Image();
  const objectUrl = URL.createObjectURL(file);

  try{
    await new Promise((resolve, reject) => {
      img.onload = resolve;
      img.onerror = reject;
      img.src = objectUrl;
    });

    const w = img.naturalWidth || img.width;
    const h = img.naturalHeight || img.height;

    // ë¹„ìœ¨ ìœ ì§€ ë¦¬ì‚¬ì´ì¦ˆ
    let nw = w;
    let nh = h;
    if (w > h && w > maxSize){
      nw = maxSize;
      nh = Math.round(h * (maxSize / w));
    } else if (h >= w && h > maxSize){
      nh = maxSize;
      nw = Math.round(w * (maxSize / h));
    }

    const canvas = document.createElement("canvas");
    canvas.width = nw;
    canvas.height = nh;
    const ctx = canvas.getContext("2d", { alpha: false });

    // í¬ê¸° ì¤„ì¼ ë•Œ í’ˆì§ˆ ê°œì„ (ì§€ì›ë˜ëŠ” ë¸Œë¼ìš°ì €ì—ì„œë§Œ)
    if (ctx && "imageSmoothingEnabled" in ctx){
      ctx.imageSmoothingEnabled = true;
      ctx.imageSmoothingQuality = "high";
    }

    ctx.drawImage(img, 0, 0, nw, nh);

    // JPEGë¡œ ë³€í™˜ (ìš©ëŸ‰ í¬ê²Œ ì¤„ì–´ë“¦)
    return canvas.toDataURL(mime, quality);
  } finally{
    URL.revokeObjectURL(objectUrl);
  }
}


   // --------- Avatar preview
let avatarDataUrl = "";

function clearAvatar(){
  avatarDataUrl = "";
  avatarInput.value = ""; // íŒŒì¼ ì¸í’‹ ë¹„ìš°ê¸°

  avatarPreview.innerHTML = `
    <button type="button"
            class="avatarClear"
            id="avatarClearBtn"
            aria-label="Remove photo"
            title="Remove">Ã—</button>
    <span>ğŸ™‚</span>
  `;

  const b = document.getElementById("avatarClearBtn");
  if (b) b.style.display = "none";
}

avatarInput.addEventListener("change", async () => {
  const file = avatarInput.files && avatarInput.files[0];

  // íŒŒì¼ ì„ íƒ ì·¨ì†Œ/ë¹„ì›€
  if (!file){
    clearAvatar();
    return;
  }

  avatarPreview.innerHTML = "<span>â³</span>";

  try{
    avatarDataUrl = await resizeImageToDataURL(file, { maxSize: 512, quality: 0.78 });

    avatarPreview.innerHTML = `
      <button type="button"
              class="avatarClear"
              id="avatarClearBtn"
              aria-label="Remove photo"
              title="Remove">Ã—</button>
      <img alt="Profile preview" src="${avatarDataUrl}">
    `;

    const btn = document.getElementById("avatarClearBtn");
    if (btn){
      btn.style.display = "flex";
      btn.addEventListener("click", clearAvatar);
    }
  }catch(e){
    console.error(e);
    clearAvatar();
    alert("Couldnâ€™t load this image.");
  }
});

// ì²˜ìŒ ë¡œë“œì‹œ ê¸°ë³¸ ìƒíƒœ í™•ì‹¤íˆ
clearAvatar();



    // --------- View switching
function show(view){
  viewSetup.classList.remove("active");
  viewChat.classList.remove("active");
  view.classList.add("active");

  document.body.classList.toggle("chatMode", view === viewChat);

  if (view === viewSetup) document.title = DEFAULT_TITLE;

  // âœ… ì±„íŒ…ë·°ë¡œ ë“¤ì–´ê°ˆ ë•Œë§ˆë‹¤ controlsH ì¬ì¸¡ì • (í•µì‹¬)
  if (view === viewChat){
    requestAnimationFrame(() => {
      setupKeyboardBar(); // ì¬í˜¸ì¶œ
    });
  }
}

    // --------- Save & load (tab-scoped)
    function saveSession(data){
      sessionStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }
    function loadSession(){
      try{
        const raw = sessionStorage.getItem(STORAGE_KEY);
        if (!raw) return null;
        return JSON.parse(raw);
      }catch(e){
        return null;
      }
    }
    function clearSession(){
      sessionStorage.removeItem(STORAGE_KEY);
    }

    function savePending(session){
  sessionStorage.setItem(PENDING_KEY, JSON.stringify(session));
}
function loadPending(){
  try{
    const raw = sessionStorage.getItem(PENDING_KEY);
    return raw ? JSON.parse(raw) : null;
  }catch(e){
    return null;
  }
}
function clearPending(){
  sessionStorage.removeItem(PENDING_KEY);
}


    // --------- Save & load (chat history, tab-scoped)
function saveHistory(history){
  sessionStorage.setItem(HISTORY_KEY, JSON.stringify(history));
}
function loadHistory(){
  try{
    const raw = sessionStorage.getItem(HISTORY_KEY);
    return raw ? JSON.parse(raw) : [];
  }catch(e){
    return [];
  }
}
function clearHistory(){
  sessionStorage.removeItem(HISTORY_KEY);
}

    // --------- Fill chat view (NULL-SAFE)
function enterChat(session){
  // âœ… ì±„íŒ… íƒ€ì´í‹€ ë³€ê²½
  const chatTitle = document.getElementById("chatTitle");
  if (chatTitle){
    chatTitle.textContent = `Chat with ${session.name}`;
  }
  // Basic display
  const tierLabel = session.tier === "uncensored" ? "+18 Uncensored" : "General";
  // const modelLabel = session.tier === "uncensored" ? "Venice Uncensored" : "DeepSeek"; // í•„ìš” ì—†ìœ¼ë©´ ì£¼ì„ ìœ ì§€

  // âœ… UI ìš”ì†Œê°€ ìˆì–´ë„/ì—†ì–´ë„ ì—ëŸ¬ ì•ˆ ë‚˜ê²Œ (Name/Language/Tier ì¹©)
  if (chipName) chipName.textContent = "Name: " + session.name;
  if (chipLang) chipLang.textContent = "Language: " + session.language;
  if (chipTier) chipTier.textContent = "Tier: " + tierLabel;

  // âœ… ì±„íŒ…ì—ì„œ ì‚¬ìš©í•  ì´ë¦„/ìƒ‰
  if (chatName) chatName.textContent = session.name;
  document.documentElement.style.setProperty("--chatColor", session.fontColor || "#000000");

  // âœ… íƒ­ íƒ€ì´í‹€
  document.title = session.name + " | roleplay-chat.com";

  // âœ… ì•„ë°”íƒ€ (DOMì´ ì—†ì–´ë„ ì—ëŸ¬ ì•ˆ ë‚˜ê²Œ)
  if (chatAvatar){
    chatAvatar.innerHTML = session.avatarDataUrl
      ? `<img alt="Profile" src="${session.avatarDataUrl}">`
      : "ğŸ™‚";
  }

  // âœ… í™”ë©´ ì „í™˜
  show(viewChat);

setUnlockUIVisibility();

  // âœ… history restore
  chatHistory = loadHistory();

  // ì±„íŒ… UI ë¹„ìš°ê³  ë‹¤ì‹œ ê·¸ë¦¬ê¸°
  const box = document.getElementById("chatBox");
  if (box){
    box.innerHTML = "";
    for (const m of chatHistory){
      appendMsg(m.role, m.content);
    }
    box.scrollTop = box.scrollHeight;
  }
  // âœ… ì²˜ìŒ ì…ì¥ & íˆìŠ¤í† ë¦¬ ì—†ì„ ë•Œë§Œ: TSì— ì²« ì¸ì‚¬ ìš”ì²­
  if (!chatHistory || chatHistory.length === 0){
    (async () => {
      try{
        const res = await fetch("/api/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            init: true,
            tier: session.tier,
            character: {
              name: session.name,
              nickname: session.nickname,
              age: Number(session.age),
              gender: session.gender,
              language: session.language,
              height: session.height,
              weight: session.weight,
              mbti: session.mbti,
              personality: session.personality,
              scenario: session.scenario
            },
            history: []
          })
        });

        const data = await res.json();
        appendMsg("assistant", data.reply);
        chatHistory = [{ role: "assistant", content: data.reply }];
        saveHistory(chatHistory);
      }catch(e){
        console.error(e);
      }
    })();
  }
}


    // --------- Paywall modal controls
    function openPayModal(){
      payErr.style.display = "none";
      payOk.style.display = "none";
      payModal.classList.add("active");
    }
    function closePayModal(){
      payModal.classList.remove("active");
      clearPending();
    }
    closePay.addEventListener("click", closePayModal);
    payModal.addEventListener("click", (e) => {
      if (e.target === payModal) closePayModal();
    });

function openImgPayModal(){
  if (imgPayErr) imgPayErr.style.display = "none";
  if (imgPayOk) imgPayOk.style.display = "none";
  if (imgPayModal) imgPayModal.classList.add("active");
}

function closeImgPayModalFn(){
  if (imgPayModal) imgPayModal.classList.remove("active");
  // imagechat ê²°ì œëŠ” pendingì„ ìœ ì§€í•´ë„ ë˜ì§€ë§Œ, ë‹«ìœ¼ë©´ ì·¨ì†Œë¡œ ë³´ê³  ì§€ìš°ëŠ” ê²Œ ê¹”ë”
  clearPending();
}

if (closeImgPay){
  closeImgPay.addEventListener("click", closeImgPayModalFn);
}
if (imgPayModal){
  imgPayModal.addEventListener("click", (e) => {
    if (e.target === imgPayModal) closeImgPayModalFn();
  });
}

// Image-chat ì „ìš© PayPal ë²„íŠ¼ ë Œë” (ê¸°ì¡´ mountPayPalButtonsì™€ ê±°ì˜ ë™ì¼, ë Œë” ìœ„ì¹˜ë§Œ ë‹¤ë¦„)
function mountPayPalButtonsImageChat(onSuccess, priceUsd = "6.90", description = "Playing image game"){
  const container = document.querySelector("#imgPaypalButtons");
  container.innerHTML = "";

  if (!window.paypal){
    if (imgPayErr){
      imgPayErr.textContent = "PayPal SDK failed to load. Please refresh and try again.";
      imgPayErr.style.display = "block";
    }
    return;
  }

  window.paypal.Buttons({
    style: { layout: "vertical", shape: "pill" },
    createOrder: (data, actions) => {
      return actions.order.create({
        purchase_units: [{
          description,
          amount: { value: String(priceUsd), currency_code: "USD" }
        }]
      });
    },
    onApprove: async (data, actions) => {
      try{
        await actions.order.capture();
        if (imgPayOk){
          imgPayOk.style.display = "block";
        }
        if (imgPayErr) imgPayErr.style.display = "none";

        setTimeout(() => {
          closeImgPayModalFn();
          onSuccess();
        }, 600);
      }catch(err){
        if (imgPayErr){
          imgPayErr.textContent = "Payment capture failed. Please try again.";
          imgPayErr.style.display = "block";
        }
        if (imgPayOk) imgPayOk.style.display = "none";
      }
    },
    onCancel: () => {
      if (imgPayErr){
        imgPayErr.textContent = "Payment cancelled.";
        imgPayErr.style.display = "block";
      }
      if (imgPayOk) imgPayOk.style.display = "none";
    },
    onError: () => {
      if (imgPayErr){
        imgPayErr.textContent = "Payment error. Please try again.";
        imgPayErr.style.display = "block";
      }
      if (imgPayOk) imgPayOk.style.display = "none";
    }
  }).render("#imgPaypalButtons");
}


    // --------- PayPal Buttons (client-only demo)
function mountPayPalButtons(onSuccess, priceUsd = "2.00", description = "Playing game"){
  const container = $("#paypalButtons");
  container.innerHTML = "";
  if (!window.paypal){
    payErr.textContent = "PayPal SDK failed to load. Please refresh and try again.";
    payErr.style.display = "block";
    return;
  }

  window.paypal.Buttons({
    style: { layout: "vertical", shape: "pill" },
    createOrder: (data, actions) => {
      return actions.order.create({
        purchase_units: [{
          description,
          amount: { value: String(priceUsd), currency_code: "USD" }
        }]
      });
    },
    onApprove: async (data, actions) => {
      try{
        await actions.order.capture();
        payOk.style.display = "block";
        payErr.style.display = "none";
        setTimeout(() => {
          closePayModal();
          onSuccess();
        }, 600);
      }catch(err){
        payErr.textContent = "Payment capture failed. Please try again.";
        payErr.style.display = "block";
        payOk.style.display = "none";
      }
    },
    onCancel: () => {
      payErr.textContent = "Payment cancelled.";
      payErr.style.display = "block";
      payOk.style.display = "none";
    },
    onError: () => {
      payErr.textContent = "Payment error. Please try again.";
      payErr.style.display = "block";
      payOk.style.display = "none";
    }
  }).render("#paypalButtons");
}


    // =========================
    // ADDED: chat.ts connection
    // =========================
    const chatInput = $("#chatInput");
    const sendBtn = $("#sendBtn");

    let chatHistory = []; // {role:"user"|"assistant", content:string}
    const PAYMENT_KEY = "roleplay-chat_paid_v1";
    let paymentStatus = sessionStorage.getItem(PAYMENT_KEY) || "unpaid"; // refresh-safe within this tab

    function appendMsg(role, content){
      const currentSession = loadSession();
const assistantName = (currentSession && currentSession.name) || "Character";
      
      const msg = document.createElement("div");
      msg.className = "chatMsg";

      // (4) ADDED: user messages on right
      if (role === "user") msg.classList.add("me");

      const who = document.createElement("div");
      who.className = "who";

who.innerHTML = (role === "assistant")
  ? (currentSession && currentSession.avatarDataUrl
      ? `<img alt="Profile" src="${currentSession.avatarDataUrl}">`
      : "ğŸ™‚")
  : "<span>YOU</span>";

      const bubble = document.createElement("div");
      bubble.className = "text";

      if (role === "assistant"){
        // (2) CHANGED: assistant content color uses --chatColor too
        bubble.innerHTML = `<div class="name" style="color: var(--chatColor);">${assistantName}</div>
                            <div style="margin-top:6px; color: var(--chatColor); white-space:pre-wrap;"></div>`;
      } else {
        bubble.innerHTML = `<div style="font-weight:800; margin-bottom:6px;">You</div>
                            <div style="color: rgba(255,255,255,.86); white-space:pre-wrap;"></div>`;
      }

      bubble.querySelector("div:last-child").textContent = content;

      msg.appendChild(who);
      msg.appendChild(bubble);
      $("#chatBox").appendChild(msg);
      $("#chatBox").scrollTop = $("#chatBox").scrollHeight;
      return msg; // âœ… ì´ ì¤„ ì¶”ê°€
    }

    async function typeWriter(targetEl, text, speed = 18){
  targetEl.textContent = "";
  for (let i = 0; i < text.length; i++){
    targetEl.textContent += text[i];
    $("#chatBox").scrollTop = $("#chatBox").scrollHeight;
    await new Promise(r => setTimeout(r, speed));
  }
}

    async function sendToChatApi(text){
      const session = loadSession();
      if (!session) throw new Error("No session");

      const tier = session.tier === "uncensored" ? "uncensored" : "general";

      const res = await fetch("/api/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          tier,
          paymentStatus: tier === "uncensored" ? paymentStatus : undefined,
          character: {
            name: session.name,
            nickname: session.nickname,
            age: Number(session.age),
            gender: session.gender,
            language: session.language,
            height: session.height,
            weight: session.weight,
            mbti: $("#mbti").value,
            personality: session.personality,
            scenario: session.scenario
          },
          message: text,
          history: chatHistory
        })
      });

      const data = await res.json().catch(() => ({}));
      if (!res.ok) {
        throw new Error(data?.error || `Request failed (${res.status})`);
      }
      return data.reply;
    }

    async function handleSend(){
      const text = chatInput.value.trim();
      if (!text) return;

      chatInput.value = "";
      appendMsg("user", text);
      chatHistory.push({ role: "user", content: text });
saveHistory(chatHistory);

      try{
        sendBtn.disabled = true;
        chatInput.disabled = true;

        const reply = await sendToChatApi(text);

        const msgEl = appendMsg("assistant", ""); // ë¹ˆ ë©”ì‹œì§€ ë¨¼ì € ë§Œë“¤ê³ 
const textEl = msgEl.querySelector(".text div:last-child"); // ë³¸ë¬¸ div ì¡ê¸°
await typeWriter(textEl, reply, 18); // âœ… íƒ€ìê¸° ì¶œë ¥
chatHistory.push({ role: "assistant", content: reply });
saveHistory(chatHistory);
        
      }catch(e){
        appendMsg("assistant", `Error: ${String(e.message || e)}`);
      }finally{
        sendBtn.disabled = false;
        chatInput.disabled = false;
        chatInput.focus();
      }
    }

    sendBtn.addEventListener("click", handleSend);
    chatInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter"){
        e.preventDefault();
        handleSend();
      }
    });
    chatInput.addEventListener("focus", () => {
  setTimeout(() => {
    const box = document.getElementById("chatBox");
    box.scrollTop = box.scrollHeight;
  }, 50);
});


    // --------- Submit flow
    form.addEventListener("submit", (e) => {
      e.preventDefault();

      const name = nameInput.value.trim();
      if (!name){
        nameInput.focus();
        return;
      }

      const tier = (form.querySelector('input[name="tier"]:checked') || {}).value || "general";

      const session = {
        name,
        nickname: $("#nickname").value.trim(),
        age: ageSelect.value,
        gender: $("#gender").value,
        language: $("#language").value,
        height: {
  unit: $("#heightUnit").value,
  cm: $("#heightCm").value ? Number($("#heightCm").value) : null,
  ft: $("#heightFt").value ? Number($("#heightFt").value) : null,
  in: $("#heightIn").value ? Number($("#heightIn").value) : null
},
weight: {
  unit: $("#weightUnit").value,
  value: $("#weightValue").value ? Number($("#weightValue").value) : null
},
        mbti: $("#mbti").value,
        personality: personality.value.trim(),
        scenario: scenario.value.trim(),
        fontColor: selectedColor,
        fontColorName: selectedColorName,
        avatarDataUrl: avatarDataUrl || "",
        tier,
        createdAt: Date.now()
      };

      if (tier === "general"){
  // âœ… ë¬´ë£ŒëŠ” ì¦‰ì‹œ í™•ì • ì €ì¥
  try{
    saveSession(session);
  }catch(e){
    console.error(e);
    session.avatarDataUrl = "";
    try{ saveSession(session); }catch(_){}
  }
  enterChat(session);

} else if (tier === "uncensored") {
  // âœ… ìœ ë£Œ(uncensored)ëŠ” ê²°ì œ ì „ê¹Œì§€ ì €ì¥ ê¸ˆì§€ (pending)
  savePending(session);

  openPayModal();
  mountPayPalButtons(() => {
    paymentStatus = "paid";
    sessionStorage.setItem(PAYMENT_KEY, "paid");

    // âœ… ê²°ì œ ì„±ê³µ ì‹œì ì—ë§Œ ì €ì¥
    session.tier = "uncensored";
    try{
      saveSession(session);
    }catch(e){
      console.error(e);
      session.avatarDataUrl = "";
      try{ saveSession(session); }catch(_){}
    }

    clearPending();
    enterChat(session);
  });

} else if (tier === "imagechat") {
 
  // âœ… ê²°ì œ ì „ ì €ì¥ ê¸ˆì§€: pendingì— ë„£ê¸°
  savePending(session);

  // âœ… 2) ìƒˆ ëª¨ë‹¬ë¡œ ê²°ì œ ($6.9)
  openImgPayModal();
  mountPayPalButtonsImageChat(() => {
    sessionStorage.setItem(IMAGECHAT_PAID_KEY, "paid");

    // âœ… 4) ìºë¦­í„°ì…‹ì—…ì€ STORAGE_KEYë¡œ ì €ì¥ë˜ì–´ /imagechatì—ì„œ ê·¸ëŒ€ë¡œ ì½ìŒ
    session.tier = "imagechat";
    try{
      saveSession(session);
    }catch(e){
      console.error(e);
      // imagechatì€ avatar í•„ìˆ˜ë¼ ì—¬ê¸°ì„œ avatar ì§€ìš°ë©´ ì•ˆ ë¨
      // ì €ì¥ ì‹¤íŒ¨ë©´ ì•ˆë‚´
      alert("Failed to save session. Please try again.");
      return;
    }

    clearPending();

    // âœ… ê²°ì œ ì™„ë£Œ í‘œì‹œ(íƒ­ì—ë§Œ)
sessionStorage.setItem(IMAGECHAT_PAID_KEY, "paid");

// âœ… ìºë¦­í„° ì €ì¥(íƒ­ì—ë§Œ)
session.tier = "imagechat";
try{
  saveSession(session);
}catch(e){
  console.error(e);
  alert("Failed to save session. Please try again.");
  return;
}

// âœ… pending ì •ë¦¬
clearPending();

// âœ… ê°™ì€ íƒ­ì—ì„œ ì´ë™
window.location.href = "/imagechat/";

  }, "6.90", "playing image game");
}
    });

    // (1) CHANGED: New opens a fresh setup tab (clears session in that new tab only)
    resetBtn.addEventListener("click", () => {
      window.open("/?new=1", "_blank");
    });

    if (gameBtn){
  gameBtn.addEventListener("click", () => {
    window.open("https://2048global.com", "_blank", "noopener,noreferrer");
  });
}

if (vpnBtn){
  vpnBtn.addEventListener("click", () => {
    window.open("https://www.2048global.com/vpn", "_blank", "noopener,noreferrer");
  });
}

    // (1) ADDED: if opened as /?new=1, clear this tab's session and payment state
    const params = new URLSearchParams(window.location.search);
if (params.get("new") === "1"){
  clearSession();
  sessionStorage.removeItem(PAYMENT_KEY);
  sessionStorage.removeItem(IMAGECHAT_PAID_KEY);
  sessionStorage.removeItem("roleplay-chat_history_v1"); // (ì¶”ê°€) íˆìŠ¤í† ë¦¬ë„ ì‚­ì œ
  paymentStatus = "unpaid";
  show(viewSetup);

  // âœ… ì¤‘ìš”: ìƒˆë¡œê³ ì¹¨í•´ë„ ë‹¤ì‹œ ì´ˆê¸°í™”ë˜ì§€ ì•Šë„ë¡ URLì—ì„œ ?new=1 ì œê±°
  history.replaceState(null, "", window.location.pathname);
}


    // --------- Restore session if exists
    const existing = loadSession();
const pending = loadPending();

function setUnlockUIVisibility(){
  const s = loadSession();
  const isPaid = sessionStorage.getItem(PAYMENT_KEY) === "paid";
  const isGeneral = s && s.tier === "general";
  if (unlockBtn){
    unlockBtn.style.display = (isGeneral && !isPaid) ? "inline-flex" : "none";
  }
}

function openPayModalForCurrentChat(){
  const s = loadSession();
  if (!s) return;

  // âœ… Unlock ì—…ê·¸ë ˆì´ë“œ ì „ìš© ëª¨ë‹¬ í…ìŠ¤íŠ¸
  const payTitle = document.getElementById("payTitle");
  const payCharName = document.getElementById("payCharName");

  if (payTitle){
    payTitle.textContent = `Unlock ${s.name} +18 Uncensored, continuing this chat ($3)`;
  }
  if (payCharName){
    payCharName.textContent = s.name;
  }

  openPayModal();

  // âœ… ê²°ì œ ì„±ê³µ ì‹œ: "í˜„ì¬ ì±„íŒ…"ì„ uncensoredë¡œ ìŠ¹ê²©
  mountPayPalButtons(
    () => {
      paymentStatus = "paid";
      sessionStorage.setItem(PAYMENT_KEY, "paid");

      const cur = loadSession();
      if (cur){
        cur.tier = "uncensored";
        try{ saveSession(cur); }catch(e){ console.error(e); }
      }

      setUnlockUIVisibility();
    },
    "3.00",
    "Upgrade game"
  );
}


if (unlockBtn){
  unlockBtn.addEventListener("click", () => {
    openPayModalForCurrentChat();
  });
}


// âœ… ê²°ì œ ì§„í–‰í•˜ë‹¤ ë‹«ì•˜ë˜ ìƒíƒœë©´: ì…‹ì—… í™”ë©´ ìœ ì§€
if (!existing){
  // ì„¸ì…˜ì´ ì—†ìœ¼ë©´ ê·¸ëƒ¥ ì…‹ì—… í™”ë©´
  show(viewSetup);
} else if (
  (existing.tier === "uncensored" && sessionStorage.getItem(PAYMENT_KEY) !== "paid") ||
  (existing.tier === "imagechat" && sessionStorage.getItem(IMAGECHAT_PAID_KEY) !== "paid")
){
  // ê²°ì œ ì „ ìƒíƒœë©´ ì…‹ì—…ìœ¼ë¡œ
  show(viewSetup);
} else {
  // ì •ìƒ ì„¸ì…˜ì´ë©´ ì´ì–´ì„œ ì§„ì…
  if (existing.tier === "imagechat"){
    window.location.href = "/imagechat/";
  } else {
    enterChat(existing);
  }
}

function setupKeyboardBar(){
  const controls = document.querySelector(".chatControls");
  const chatBox = document.getElementById("chatBox");

  function measureControlsH(){
    if (!controls) return;
    const h = controls.getBoundingClientRect().height || 76;
    document.documentElement.style.setProperty("--controlsH", h + "px");
  }

  function updateKeyboardOffset(){
    // iOS Safariì—ì„œ í‚¤ë³´ë“œê°€ ì˜¬ë¼ì˜¤ë©´ visualViewport.heightê°€ ì¤„ì–´ë“¦
    const vv = window.visualViewport;
    if (!vv){
      document.documentElement.style.setProperty("--kb", "0px");
      measureControlsH();
      return;
    }

    // í‚¤ë³´ë“œë¡œ ê°€ë ¤ì§„ ë†’ì´(ëŒ€ëµ)
    const kb = Math.max(0, window.innerHeight - vv.height - vv.offsetTop);
    document.documentElement.style.setProperty("--kb", kb + "px");
    document.body.classList.toggle("kbUp", kb > 0);
    measureControlsH();

    // ë°”ë‹¥ ìœ ì§€
    if (chatBox){
      requestAnimationFrame(() => {
        chatBox.scrollTop = chatBox.scrollHeight;
      });
    }
  }

  // ì´ˆê¸°
  measureControlsH();
  updateKeyboardOffset();

  // í‚¤ë³´ë“œ/ì£¼ì†Œì°½ ë³€í™” ëŒ€ì‘
  if (window.visualViewport){
    window.visualViewport.addEventListener("resize", updateKeyboardOffset);
    window.visualViewport.addEventListener("scroll", updateKeyboardOffset);
  }
  window.addEventListener("resize", updateKeyboardOffset);
}

    
  </script>
</body>
</html>










